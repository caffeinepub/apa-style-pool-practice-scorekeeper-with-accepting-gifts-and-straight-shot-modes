{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "APA 9-ball rack scoring: 9-ball ends rack and locks edits",
  "requirements": [
    {
      "id": "REQ-32",
      "summary": "When ball 9 is marked pocketed, auto-mark remaining balls 1–8 as dead, lock rack editing/turn switching, and allow undoing only by unmarking ball 9 (which reverts only auto-dead balls).",
      "acceptanceCriteria": [
        "In the APA rack scoring panel, if ball 9 is marked as pocketed by Player A or Player B, all remaining unscored balls 1–8 are automatically set to Dead Ball so the rack totals reach 10 points.",
        "After ball 9 is marked as pocketed, the UI disallows changing the state of balls 1–8 (including marking/unmarking dead balls) and disallows switching turns, unless the user first unmarks ball 9.",
        "If ball 9 is unmarked after being pocketed, any balls that were auto-marked dead solely due to the 9-ball being made are reverted back to unscored, restoring normal editing for the rack.",
        "The existing behavior of awarding the 9-ball’s 2 points to the player who pocketed it (based on the active player at the time of selection) remains intact.",
        "All user-facing text related to this behavior is in English and clearly states that making the 9-ball ends the rack."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/apa/ApaRackScoringPanel.tsx",
          "operation": "modify",
          "description": "Implement a rack-locked state when ball 9 is pocketed (by either player), automatically set all remaining unscored balls 1–8 to 'dead', and disable all scoring/dead-ball interactions for balls 1–8 plus disable turn switching while locked. Ensure ball 9 remains clickable to unmark/undo, and when unmarked revert only balls that were auto-marked dead due to the 9-ball (do not affect balls previously marked dead or scored). Update the panel’s English helper text to explicitly state that making the 9-ball ends the rack and locks editing until the 9-ball is unmarked."
        },
        {
          "path": "frontend/src/components/apa/ApaBallButton.tsx",
          "operation": "modify",
          "description": "Ensure the ball button disabled state is properly supported for the rack-locked behavior (visual/interaction consistency), so balls 1–8 are disabled when the rack is locked while ball 9 remains enabled for undo."
        }
      ]
    }
  ]
}