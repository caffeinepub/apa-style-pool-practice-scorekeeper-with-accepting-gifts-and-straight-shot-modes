{
  "kind": "build_request",
  "title": "APA Practice â€” End-of-Match Finalization (Surgical Fix)",
  "projectName": "APA Scorekeeper",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Remove the 'Resume (Undo Accidental Win)' button from the APA Practice game interface after match finalization",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "Remove 'Resume (Undo Accidental Win)'",
          "Remove the Resume button"
        ]
      },
      "acceptanceCriteria": [
        "Resume button is not visible after a winning rack is finalized",
        "No UI elements allow undoing a finalized match"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Remove the Resume button handler and all snapshot/rollback plumbing used exclusively for the Resume functionality in APA Practice mode",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "Remove its handler",
          "Remove any snapshot / rollback plumbing used only for Resume"
        ]
      },
      "acceptanceCriteria": [
        "No handler code exists for resuming after finalization",
        "Rack snapshot/restore logic for post-finalization rollback is removed",
        "No state corruption occurs from attempted rollback operations"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Enforce that after pressing 'End Rack' on a winning rack in APA Practice, gameplay stops permanently: balls become unclickable, the rack scoring panel does not render again, and the match enters a final summary state where it can only be saved or discarded",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "Once End Rack finalizes a winning rack: Gameplay must stop",
          "Balls must not become clickable",
          "Rack scoring panel must not render again",
          "Match may only be saved or discarded"
        ]
      },
      "acceptanceCriteria": [
        "After 'End Rack' finalizes a winning rack, no ball buttons are clickable",
        "Rack scoring panel does not appear after finalization",
        "Only save/discard actions are available post-finalization",
        "No code path allows returning to gameplay after finalization"
      ]
    },
    {
      "id": "REQ-4",
      "text": "Fix the save logic in APA Practice to persist authoritative values as-is without recalculation: use player1TotalScore and player2TotalScore for scores, session.sharedInnings for innings (same value for both players), and sum of session.racks[].playerXDefensiveShots for defensive shots",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "Persist the values that are already finalized and tracked in state",
          "Do not derive, recompute, or reinterpret these values"
        ]
      },
      "acceptanceCriteria": [
        "Save logic reads player1TotalScore and player2TotalScore directly without recalculation",
        "Innings value is taken from session.sharedInnings for both players",
        "Defensive shots are computed as sum of defensive shot values across racks",
        "No scoring logic re-derives totals from ball states at save time"
      ]
    },
    {
      "id": "REQ-5",
      "text": "In buildApaNineBallMatch for APA Practice, preserve both totalScore and pointsEarnedRunningTotal fields by persisting the same finalized value into both fields without zeroing, removing, or combining them",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "Keep both: totalScore, pointsEarnedRunningTotal",
          "Persist the same finalized value into both fields",
          "Do not zero them. Do not remove them. Do not combine them."
        ]
      },
      "acceptanceCriteria": [
        "Both totalScore and pointsEarnedRunningTotal are present in saved match records",
        "Both fields contain the same finalized score value",
        "No aggregation or combination logic manipulates these fields",
        "Neither field is zeroed out or removed"
      ]
    }
  ],
  "constraints": [
    "Do not change rack scoring logic",
    "Do not change dead ball logic",
    "Do not change turn locking rules",
    "Do not change running total behavior during live gameplay",
    "Do not change chart aggregation logic",
    "Do not change match history format",
    "Do not modify any non-APA-Practice game modes",
    "Do not redesign or rewrite gameplay systems",
    "Match finalization occurs only when 'End Rack' is pressed on the winning rack (there is no separate 'End Match' button)",
    "Pre-finalization behavior must remain unchanged: balls in the current inning may be unselected, running totals may fluctuate, win indicators may appear/disappear"
  ],
  "nonGoals": [
    "Adding new undo/redo mechanics after finalization",
    "Recalculating scores from ball states at save time",
    "Changing gameplay rules or scoring calculations",
    "Modifying behavior of other game modes",
    "Redesigning the UI or adding new features beyond finalization enforcement"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}