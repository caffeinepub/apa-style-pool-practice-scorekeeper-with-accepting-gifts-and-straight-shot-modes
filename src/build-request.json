{
  "kind": "build_request",
  "title": "Fix 9-ball unlock behavior and session abandon error",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Fix the auto-dead ball revert logic in ApaRackScoringPanel: when the 9-ball is unclicked, all balls that were auto-marked as dead in the current inning (balls 4, 5, 6, 7, 8 in the screenshot) must revert to unscored/clickable state instead of remaining locked",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "balls also remain locked when unclick nineball",
          "After clicking ball 1 and then unclicking the 9-ball, balls 4, 5, 6, 7, 8 remain locked/grayed out"
        ]
      },
      "acceptanceCriteria": [
        "When 9-ball is clicked, balls 2-8 that are unscored are auto-marked as dead",
        "When 9-ball is then unclicked, those auto-marked dead balls revert to blank/clickable state",
        "Only balls that were auto-marked in the current inning are reverted, not manually marked dead balls",
        "The fix must preserve existing manual ball state changes"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Fix React error #185 in PracticeGamePage when clicking 'End Session Without Saving': add a microtask delay (setTimeout with 0ms) between clearPracticeSession() and navigate('/') to prevent state updates on unmounted components",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Minified React error #185",
          "dispatchSetState",
          "getRootForUpdatedFiber"
        ]
      },
      "acceptanceCriteria": [
        "Clicking 'End Session Without Saving' no longer throws React error #185",
        "Session state is cleared before navigation begins",
        "Navigation to home page completes successfully",
        "No console errors appear during the abandon flow"
      ]
    }
  ],
  "constraints": [
    "Do not modify any other scoring logic or ball state behavior",
    "Do not change the APA scoring rules or points calculation",
    "Preserve all existing session persistence mechanisms",
    "Do not alter the UI layout or styling of the game page"
  ],
  "nonGoals": [
    "Changing how the 9-ball auto-dead feature works when clicking the 9-ball",
    "Modifying any other session end flows (save, complete match)",
    "Refactoring the rack scoring panel architecture",
    "Adding new confirmation dialogs or user prompts"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}