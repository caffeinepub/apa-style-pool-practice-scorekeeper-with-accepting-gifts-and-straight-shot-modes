{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-13T19:16:12.366Z",
  "summary": "Diff implements substantial APA 9-ball Equalizer UI/scoring changes (skill-level points-to-win mapping, rack total validation with dead balls, defensive shots, innings/PPI display, match-point outcome types) and updates branding from “8” to “9”. Backend types were expanded with an APA 9-ball match variant and a migration module was added, but some requirements (notably login persistence regression fix details and custom/user-provided match-point thresholds) are not clearly evidenced, and the migration logic appears incomplete/incorrect per the diff summary.",
  "missing_requirements": [
    {
      "id": "REQ-12",
      "requirement": "Fix regression where previously authenticated users are unexpectedly logged out after reload/update; sessions persist across reloads/routine redeploys until delegation expires or user logs out; show clear English message if session expired; do not edit immutable hook files (compose/wrap instead).",
      "reason": "AuthGate was modified to show an initializing spinner and updated branding, but the diff summary does not show any change that would ensure delegation/session persistence across reloads/redeploys, nor any explicit handling/message for expired/invalid delegations. No wrapper/composition mechanism beyond using the existing hook is evidenced.",
      "evidence": [
        "frontend/src/components/auth/AuthGate.tsx",
        "frontend-file-summaries.txt"
      ]
    },
    {
      "id": "REQ-15",
      "requirement": "Use the exact user-provided SL-specific threshold ranges (SL1–SL9) for APA 20-point match result conversion (winner 12–20 / loser 0–8).",
      "reason": "The implementation introduces a hard-coded DEFAULT_MATCH_POINT_CHART in code; the diff summary shows no mechanism for using “user-provided” thresholds (e.g., UI input, configuration, persistence, or injection of a provided chart).",
      "evidence": [
        "frontend/src/lib/apa/apaMatchPoints.ts"
      ]
    },
    {
      "id": "REQ-16",
      "requirement": "If changing backend stable types requires a state upgrade, add a conditional migration in backend/migration.mo to preserve existing saved matches without traps (conditional migration policy).",
      "reason": "A new backend/migration.mo was added, but its run() function maps OldMatchRecord to NewMatchRecord by returning oldRecord unchanged, despite the variant type set differing (NewMatchRecord adds #apaNineBall). From the diff summary alone, this migration does not demonstrate a conditional/compatible transformation to ensure safe upgrades and preservation without traps.",
      "evidence": [
        "backend/migration.mo",
        "backend/main.mo"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Backend APA nine-ball match schema includes many extra fields (seasonType, matchType, matchBehaviorPhase, winPercentage, isPlayerOfMatch, pointsEarnedRunningTotal, TeamStats with penalties/forfeits, rack fields like validBreak/breakMaiden/ballsOnBreak/runOut, etc.) beyond the requested persisted fields for APA practice (SLs, points-to-win, per-rack ball/dead-ball points, defensive shots, innings/PPI, match-point conversion).",
      "reason": "REQ-16 asks to persist APA practice fields needed to reconstruct scoring/results; the diff adds a significantly more elaborate schema not requested and not tied to stated acceptance criteria.",
      "evidence": [
        "backend/main.mo",
        "backend/migration.mo",
        "frontend/src/lib/matches/matchBuilders.ts"
      ]
    },
    {
      "description": "Straight Shot “moving average (last 10 sessions) showing stroke performance trends.”",
      "reason": "Not requested by REQ-12–REQ-17 and not part of the stated goals; appears as an additional analytics feature.",
      "evidence": [
        "frontend-file-summaries.txt"
      ]
    },
    {
      "description": "Footer branding includes “Built with ❤️ using caffeine.ai” link.",
      "reason": "Not requested by REQ-12–REQ-17; adds new branding/copy not specified in the BuildRequest.",
      "evidence": [
        "frontend/src/components/layout/AppLayout.tsx"
      ]
    }
  ],
  "confidence": 0.68,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "frontend-file-summaries.txt",
    "frontend/src/components/apa/ApaRackScoringPanel.tsx",
    "frontend/src/components/apa/ApaResultsSummary.tsx",
    "frontend/src/components/auth/AuthGate.tsx",
    "frontend/src/components/layout/AppLayout.tsx",
    "frontend/src/components/matches/MatchSummaryCard.tsx",
    "frontend/src/lib/apa/apaEqualizer.ts",
    "frontend/src/lib/apa/apaMatchPoints.ts",
    "frontend/src/lib/apa/apaScoring.ts",
    "frontend/src/lib/matches/matchBuilders.ts",
    "frontend/src/pages/HomePage.tsx",
    "frontend/src/pages/apa/PracticeGamePage.tsx",
    "frontend/src/pages/apa/PracticeStartPage.tsx",
    "frontend/src/pages/history/MatchDetailsPage.tsx",
    "project_state.json"
  ]
}